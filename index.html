<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="GastroVisionAI - AI-powered medical imaging for early pancreatic cancer detection using deep learning models.">
<title>GastroVisionAI | AI Medical Intelligence</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

<style>
/* =====================
   CSS VARIABLES
===================== */
:root{
  --primary:#38bdf8;
  --primary-dark:#0ea5e9;
  --accent:#7dd3fc;
  --bg-dark:#020617;
  --glass:rgba(10,25,60,.65);
  --border:rgba(56,189,248,.35);
  --border-hover:rgba(56,189,248,.6);
  --glow:rgba(56,189,248,.5);
  --text-primary:#e6f1ff;
  --text-secondary:rgba(230,241,255,.9);
  --warning:#f59e0b;
  --warning-bg:rgba(245,158,11,0.15);
  --info:#3b82f6;
  --info-bg:rgba(59,130,246,0.15);
  --medical:#8b5cf6;
  --medical-bg:rgba(139,92,246,0.15);
  --success:#10b981;
  --success-bg:rgba(16,185,129,0.15);
  --danger:#ef4444;
  --danger-bg:rgba(239,68,68,0.15);
}

/* =====================
   CORE THEME (B2)
===================== */
*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:
    radial-gradient(circle at 20% 20%, #0f1e3d, transparent 40%),
    radial-gradient(circle at 80% 80%, #0a3d62, transparent 40%),
    linear-gradient(135deg,#020617,#030b1e,#061633);
  color:var(--text-primary);
  overflow-x:hidden;
}

/* Neon grid */
body::before{
  content:'';
  position:fixed;
  inset:0;
  background:
    repeating-linear-gradient(0deg,rgba(0,180,255,.06),rgba(0,180,255,.06)1px,transparent 1px,transparent 28px),
    repeating-linear-gradient(90deg,rgba(0,180,255,.06),rgba(0,180,255,.06)1px,transparent 1px,transparent 28px);
  pointer-events:none;
  z-index:0;
}

/* =====================
   HERO
===================== */
header{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  position:relative;
  z-index:1;
}

header h1{
  font-family:'Orbitron', sans-serif;
  font-size:clamp(2.5rem,6vw,4.5rem);
  letter-spacing:4px;
  background:linear-gradient(90deg,var(--accent),var(--primary),var(--primary-dark));
  background-clip:text;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin:0 0 20px 0;
}

header p{
  max-width:900px;
  font-size:clamp(1rem,2vw,1.35rem);
  color:var(--text-secondary);
  margin:0;
}

/* Navigation */
nav{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  z-index:10;
}

nav ul{
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  gap:20px;
}

nav a{
  text-decoration:none;
  color:var(--text-primary);
  font-weight:500;
  transition:.3s ease;
}

nav a:hover{
  color:var(--primary);
}

/* =====================
   DNA STRANDS
===================== */
.dna{
  position:absolute;
  width:36px;
  height:260px;
  background:linear-gradient(to right,rgba(56,189,248,.35) 50%,rgba(14,165,233,.35) 50%);
  border-radius:20px;
  animation:dnaFloat 18s linear infinite;
  opacity:.5;
  will-change:transform;
}

@keyframes dnaFloat{
  0%{transform:translateY(0) rotate(0);}
  50%{transform:translateY(-70px) rotate(180deg);}
  100%{transform:translateY(0) rotate(360deg);}
}

.dna:nth-child(1){left:10%;top:20%;}
.dna:nth-child(2){left:40%;top:10%;animation-duration:22s;}
.dna:nth-child(3){left:70%;top:25%;animation-duration:24s;}
.dna:nth-child(4){left:88%;top:15%;animation-duration:26s;}

/* =====================
   SECTIONS
===================== */
section{
  padding:100px 20px;
  max-width:1300px;
  margin:auto;
  position:relative;
  z-index:1;
}

section h2{
  font-family:'Orbitron';
  text-align:center;
  font-size:2.8rem;
  margin-bottom:35px;
}

.section-text{
  max-width:900px;
  margin:0 auto 40px;
  text-align:center;
  line-height:1.7;
  opacity:.9;
}

.about-wrapper{
  display:flex;
  flex-direction:row;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  gap:30px;
  max-width:1200px;
  margin:0 auto;
}

.about-image{
  width:350px;
  height:280px;
  object-fit:cover;
  border-radius:24px;
  border:1px solid var(--border);
  box-shadow:0 0 40px var(--glow);
  transition:.3s ease;
}

.about-image:hover{
  border-color:var(--border-hover);
  box-shadow:0 0 60px rgba(56,189,248,.4);
}

/* =====================
   GLASS CARDS
===================== */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:35px;
}

.card{
  background:var(--glass);
  backdrop-filter:blur(18px);
  border-radius:24px;
  padding:35px;
  border:1px solid var(--border);
  box-shadow:0 0 40px var(--glow);
  transition:.4s ease;
  will-change:transform,box-shadow;
}

.card:hover{
  transform:translateY(-10px) scale(1.02);
  box-shadow:0 0 80px rgba(56,189,248,.6);
  border-color:var(--border-hover);
}

.card h3{
  font-family:'Orbitron';
  margin-bottom:10px;
}

.card.pulse{
  animation:pulse 1.6s infinite alternate;
}

@keyframes pulse{
  from{box-shadow:0 0 25px rgba(56,189,248,.4);}
  to{box-shadow:0 0 70px rgba(56,189,248,.9);}
}

/* =====================
   AI DEMO
===================== */
.demo{
  display:flex;
  flex-wrap:wrap;
  gap:60px;
  justify-content:center;
  align-items:center;
}

.mammo{
  width:min(90vw,680px);
  height:540px;
  border-radius:30px;
  border:2px solid rgba(56,189,248,.7);
  background:rgba(0,30,80,.6);
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
  font-size:1.2rem;
  background-size:cover;
  background-position:center;
  box-shadow:0 0 60px rgba(56,189,248,.5);
  transition:.5s ease;
  position:relative;
}

.mammo.analyzing{
  animation:scan 1.2s infinite alternate;
}

@keyframes scan{
  from{box-shadow:0 0 50px rgba(56,189,248,.6);}
  to{box-shadow:0 0 110px rgba(56,189,248,1);}
}

form{
  max-width:420px;
  width:100%;
  display:flex;
  flex-direction:column;
  gap:16px;
}

input{
  padding:15px;
  border-radius:12px;
  border:1px solid rgba(56,189,248,.6);
  background:#020617;
  color:white;
  font-family:inherit;
  transition:.3s ease;
}

input:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 15px rgba(56,189,248,.4);
}

input::file-selector-button{
  padding:8px 16px;
  background:var(--primary);
  border:none;
  border-radius:8px;
  color:white;
  cursor:pointer;
  transition:.2s;
}

input::file-selector-button:hover{
  background:var(--primary-dark);
}

button{
  padding:16px;
  border-radius:50px;
  border:none;
  background:linear-gradient(135deg,var(--primary),#2563eb);
  color:white;
  cursor:pointer;
  transition:.3s ease;
  font-weight:500;
  will-change:transform;
}

button:hover{
  transform:scale(1.07);
}

button:active{
  transform:scale(0.98);
}

button:disabled{
  opacity:.5;
  cursor:not-allowed;
  transform:none;
}

#result{
  padding:20px;
  border-radius:12px;
  margin-top:10px;
  min-height:60px;
  display:none;
  max-height:500px;
  overflow-y:auto;
}

#result.show{
  display:block;
  animation:fadeIn .4s ease;
}

#result.positive{
  background:var(--danger-bg);
  border:1px solid var(--danger);
  color:#fca5a5;
}

#result.negative{
  background:var(--success-bg);
  border:1px solid var(--success);
  color:#86efac;
}

#result.warning{
  background:var(--warning-bg);
  border:1px solid var(--warning);
  color:#fcd34d;
}

#result.info{
  background:var(--info-bg);
  border:1px solid var(--info);
  color:#93c5fd;
}

#result.medical{
  background:var(--medical-bg);
  border:1px solid var(--medical);
  color:#c4b5fd;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(-10px)}
  to{opacity:1;transform:translateY(0)}
}

/* =====================
   RESPONSIVE DESIGN
===================== */
@media (max-width:768px){
  section{
    padding:60px 15px;
  }
  
  section h2{
    font-size:2rem;
  }
  
  .demo{
    gap:30px;
  }
  
  .mammo{
    height:350px;
  }
  
  .grid{
    grid-template-columns:1fr;
  }
}

@media (max-width:480px){
  header h1{
    font-size:2rem;
  }
  
  header p{
    font-size:1rem;
  }
  
  section{
    padding:40px 10px;
  }
  
  .mammo{
    height:300px;
  }
  
  form{
    max-width:100%;
  }
  
  .about-image{
    width:100%;
    max-width:300px;
  }
}

/* =====================
   PARTICLES + CANVAS
===================== */
#particles,canvas{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
}

.particle{
  position:absolute;
  width:5px;
  height:5px;
  border-radius:50%;
  background:#7dd3fc;
  animation:float linear forwards;
}

@keyframes float{
  from{transform:translateY(0);opacity:1;}
  to{transform:translateY(-120vh);opacity:0;}
}

/* =====================
   FOOTER
===================== */
footer{
  text-align:center;
  padding:50px;
  background:#020617;
  border-top:1px solid rgba(56,189,248,.3);
}

/* =====================
   PROGRESS BAR
===================== */
#progressBar{
  height:3px;
  background:linear-gradient(90deg,var(--primary),var(--primary-dark));
  width:0%;
  transition:width .1s ease;
  position:fixed;
  top:0;
  left:0;
  z-index:999;
}

#progressBar.active{
  animation:progressAnim 2.2s ease-in-out forwards;
}

@keyframes progressAnim{
  0%{width:0%}
  50%{width:60%}
  100%{width:100%}
}

/* History Styles */
.history-item{
  background:rgba(56,189,248,.1);
  border-left:3px solid var(--primary);
  padding:8px 12px;
  border-radius:6px;
  margin:6px 0;
  font-size:0.85rem;
  cursor:pointer;
  transition:.2s ease;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.history-item:hover{
  background:rgba(56,189,248,.2);
  transform:translateX(4px);
}

.history-item-text{
  flex:1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.history-item-delete{
  background:none;
  border:none;
  color:#fca5a5;
  cursor:pointer;
  font-size:1.1rem;
  padding:0;
  margin-left:8px;
  opacity:.6;
  transition:.2s;
  flex-shrink:0;
}

.history-item-delete:hover{
  opacity:1;
  color:#ff6b6b;
}

#historyList{
  max-height:200px;
  overflow-y:auto;
  display:none;
}

#historyList.expanded{
  display:block;
}

/* =====================
   IMAGE EDITOR
===================== */
#editorContainer{
  display:none;
  background:rgba(10,25,60,.8);
  border:1px solid var(--border);
  border-radius:24px;
  padding:20px;
  margin:20px 0;
  max-width:680px;
}

#editorContainer.active{
  display:block;
}

.editor-canvas{
  width:100%;
  max-width:680px;
  border:1px solid var(--border);
  border-radius:12px;
  margin-bottom:15px;
  background:#000;
}

.editor-controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:15px;
}

.editor-btn{
  padding:10px 16px;
  background:rgba(56,189,248,.3);
  border:1px solid var(--border);
  color:var(--text-primary);
  border-radius:8px;
  cursor:pointer;
  transition:.2s ease;
  font-size:0.9rem;
}

.editor-btn:hover{
  background:rgba(56,189,248,.5);
  border-color:var(--border-hover);
}

.slider-group{
  display:flex;
  align-items:center;
  gap:10px;
  margin:10px 0;
}

.slider-group label{
  min-width:80px;
  font-size:0.9rem;
}

.slider-group input[type="range"]{
  flex:1;
  cursor:pointer;
}

/* =====================
   MODEL ACCURACY STATS
===================== */
.model-stats{
  background:rgba(56,189,248,.1);
  border:1px solid var(--border);
  border-radius:12px;
  padding:20px;
  margin:20px 0;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:20px;
}

.stat-box{
  text-align:center;
}

.stat-value{
  font-size:1.8rem;
  color:var(--accent);
  font-weight:bold;
  margin-bottom:5px;
}

.stat-label{
  font-size:0.9rem;
  color:var(--text-secondary);
}

/* =====================
   EXPORT SECTION
===================== */
.export-section{
  display:flex;
  gap:10px;
  margin:20px 0;
  flex-wrap:wrap;
}

.export-btn{
  padding:12px 20px;
  background:linear-gradient(135deg,#10b981,#059669);
  border:none;
  color:white;
  border-radius:8px;
  cursor:pointer;
  transition:.2s ease;
  font-weight:500;
}

.export-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 5px 15px rgba(16,185,129,.3);
}

.export-btn:disabled{
  opacity:.5;
  cursor:not-allowed;
  transform:none;
}

#history{
  margin-top:30px;
  max-width:420px;
  width:100%;
}

#history h3{
  color:var(--accent);
  font-size:0.95rem;
  margin:0 0 10px 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  user-select:none;
}

#history h3:hover{
  opacity:.8;
}

.history-header-controls{
  display:flex;
  gap:10px;
  align-items:center;
}

.history-toggle{
  font-size:0.8rem;
  opacity:.7;
}

.clear-history-btn{
  background:rgba(239,68,68,.3);
  color:#fca5a5;
  border:1px solid rgba(239,68,68,.5);
  padding:4px 10px;
  border-radius:4px;
  font-size:0.75rem;
  cursor:pointer;
  transition:.2s ease;
  white-space:nowrap;
}

.clear-history-btn:hover{
  background:rgba(239,68,68,.5);
}

/* Connection Status Indicator */
#connectionStatus{
  position:fixed;
  top:20px;
  right:20px;
  padding:10px 20px;
  border-radius:8px;
  font-size:0.9rem;
  z-index:10000;
  display:none;
  animation:fadeIn .3s ease;
  box-shadow:0 4px 20px rgba(0,0,0,0.3);
}

#connectionStatus.connected{
  background:rgba(34,197,94,0.9);
  color:white;
  display:block;
}

#connectionStatus.disconnected{
  background:rgba(239,68,68,0.9);
  color:white;
  display:block;
}

/* Loading Overlay */
#loadingOverlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(2,6,23,0.95);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
  display:none;
}

.loading-spinner{
  width:60px;
  height:60px;
  border:4px solid var(--border);
  border-top:4px solid var(--primary);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:20px;
}

@keyframes spin{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}

.loading-text{
  font-size:1.2rem;
  color:var(--accent);
  text-align:center;
}

/* Risk Level Badges */
.risk-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:20px;
  font-size:0.8rem;
  font-weight:600;
  margin:2px;
}

.risk-high{
  background:var(--danger);
  color:white;
}

.risk-moderate{
  background:var(--warning);
  color:#000;
}

.risk-low{
  background:var(--info);
  color:white;
}

.risk-medical{
  background:var(--medical);
  color:white;
}

.risk-none{
  background:var(--success);
  color:white;
}

.section-nav{
  margin-top:50px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:18px;
  flex-wrap:wrap;
}

/* If a .section-nav ends up inside a grid, span full width and stay centered */
.grid > .section-nav{
  grid-column:1 / -1;
  justify-content:center;
  margin-top:28px;
}

.section-nav a{
  text-decoration:none;
  padding:10px 18px;
  border-radius:30px;
  font-size:0.85rem;
  font-weight:500;
  color:var(--text-primary);
  border:1px solid var(--border);
  background:rgba(56,189,248,0.15);
  transition:.25s ease;
}

.section-nav a:hover{
  background:rgba(56,189,248,0.35);
  border-color:var(--border-hover);
  box-shadow:0 0 20px rgba(56,189,248,.4);
  transform:translateY(-2px);
}

html{
  scroll-behavior:smooth;
}

/* Button styles for Next/Back/Top links */
.btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 14px;
  border-radius:28px;
  background:linear-gradient(135deg,rgba(56,189,248,0.12),rgba(56,189,248,0.06));
  border:1px solid var(--border);
  color:var(--text-primary);
  text-decoration:none;
  font-weight:600;
  transition:transform .18s ease,box-shadow .18s ease,background .18s ease;
  box-shadow:0 6px 18px rgba(2,6,23,0.4);
}
.btn:hover{transform:translateY(-3px) scale(1.02);background:linear-gradient(135deg,rgba(56,189,248,0.2),rgba(56,189,248,0.08));border-color:var(--border-hover);box-shadow:0 10px 30px rgba(56,189,248,0.12);}
.btn:active{transform:translateY(0) scale(0.98);}
.btn-next{background:linear-gradient(90deg,var(--primary),var(--primary-dark));color:white;border:none;}
.btn-next:hover{filter:brightness(1.03);box-shadow:0 8px 30px rgba(14,165,233,0.18);}
.btn-back{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text-secondary);}
.btn-top{background:transparent;color:var(--accent);border:1px dashed rgba(125,211,252,0.12);}

#map {
  width: 100%;
  height: 400px;
}
</style>
</head>

<body>

<div id="progressBar"></div>
<div id="connectionStatus"></div>
<div id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text" id="loadingText">Connecting to AI Server...</div>
</div>

<div class="dna"></div>
<div class="dna"></div>
<div class="dna"></div>
<div class="dna"></div>
<div id="particles"></div>
<canvas id="neural"></canvas>

<header id="home">
  <h1>GastroVisionAI</h1>
  <p>AI-Powered Medical Imaging for Early Pancreatic Cancer Detection in Resource-Limited Regions</p>
</header>

<nav>
  <ul>
    <li><a href="#home">Home</a></li>
    <li><a href="#about">About</a></li>
    <li><a href="#features">Features</a></li>
    <li><a href="#methodology">Method</a></li>
    <li><a href="#demo">Live Demo</a></li>
  </ul>
</nav>


<section id="about">
  <h2>About the Project</h2>

  <div class="about-wrapper">
    <a href="https://www.aoaortho.com/mri-frequently-asked-questions-everything-you-need-to-know/" target="_blank" rel="noopener">
      <img src="image1.jpg" alt="Closed-bore MRI Scanner" class="about-image">
    </a>
    <a href="https://sciencelink.com/noticias/cancer-de-pancreas-inoperable-nuevos-hallazgos-demuestran-supervivencia-prolongada-con-mridian-smart/" target="_blank" rel="noopener">
      <img src="image2.jpg" alt="Pancreas Picture" class="about-image">
    </a>
    <a href="https://adirondackradiology.com/services/open-mri" target="_blank" rel="noopener"> 
      <img src="photo3.jpeg" alt="Open Type MRI Scanner" class="about-image">
    </a>

    <p class="section-text">
      GastroVisionAI is an artificial intelligence-driven diagnostic platform designed to support clinicians
      in the early detection of pancreatic cancer. The system integrates deep learning models trained on MRI
      images to deliver fast, accurate, and cost-efficient diagnostic assistance, particularly
      for underserved healthcare environments.
    </p>
  </div>
  <div class="section-nav">
    <a href="#home" class="btn btn-top">‚¨Ü Top</a>
    <a href="#features" class="btn btn-next">Next ‚ûú</a>
  </div>

</section>
 
<section id="features">
<h2>Key Features</h2>
<div class="grid">
  <div class="card pulse"><h3>Deep Learning Analysis</h3><p>CNN models identify early malignant patterns.</p></div>
  <div class="card pulse"><h3>Resource-Efficient AI</h3><p>Optimized for low-compute clinical environments.</p></div>
  <div class="card pulse"><h3>Clinical Suggestion Support</h3><p>Interpretable outputs with confidence scores.</p></div>
  <div class="card pulse"><h3>Web-Based Platform</h3><p>Remote access for regional healthcare centers.</p></div>
  </div>
  <div class="section-nav">
    <a href="#home" class="btn btn-top">‚¨Ü Top</a>
    <a href="#methodology" class="btn btn-next">Next ‚ûú</a>
  </div>
</section>

<section id="methodology">
<h2>Model Training and Methodology</h2>
<div class="grid">
  <div class="card"><h3>Dataset</h3><p>Ethically approved MRI datasets from RoboFlow.</p></div>
  <div class="card"><h3>Preprocessing</h3><p>Normalization, resizing, and augmentation techniques.</p></div>
  <div class="card"><h3>Architecture</h3><p>ResNet / EfficientNet CNNs with transfer learning.</p></div>
  <div class="card"><h3>Evaluation Metrics</h3><p>Accuracy, sensitivity, specificity, and AUC-ROC.</p></div>
  <div class="section-nav">
    <a href="#about" class="btn btn-back">‚¨Ö Back</a>
    <a href="#demo" class="btn btn-next">Next ‚ûú</a>
  </div>

</div>
</section>

<section id="demo">
<h2>Live AI Demonstration</h2>
<div class="demo">
  <div id="mammo" class="mammo">Upload Medical Image</div>
  <form id="form">
    <label for="img" style="display:block;margin-bottom:8px;font-size:0.95rem;">Select Medical Image:</label>
    <input type="file" id="img" accept="image/*" required aria-label="Upload medical image for AI analysis">
    
    <!-- Model Accuracy Stats -->
    <div class="model-stats">
      <div class="stat-box">
        <div class="stat-value" id="statAccuracy">94.2%</div>
        <div class="stat-label">Accuracy</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="statSensitivity">92.8%</div>
        <div class="stat-label">Sensitivity</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="statSpecificity">95.1%</div>
        <div class="stat-label">Specificity</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="statAUC">0.976</div>
        <div class="stat-label">AUC-ROC</div>
      </div>
    </div>
    
    <button type="submit" id="submitBtn" aria-label="Run AI pancreatic cancer detection scan">Run AI Scan</button>
    
    <!-- Export Section -->
    <div class="export-section" id="exportSection" style="display:none;">
      <button type="button" class="export-btn" id="exportPdfBtn">üìÑ Export Report</button>
      <button type="button" class="export-btn" id="exportCsvBtn">üìä Export CSV</button>
    </div>
    
    <div id="result" role="status" aria-live="polite" aria-label="AI analysis result"></div>
    <div id="history"></div>
  </form>
    <div class="section-nav">
      <a href="#methodology" class="btn btn-back">‚¨Ö Back</a>
      <a href="#home" class="btn btn-top">‚¨Ü Top</a>
    </div>
</div>
</section>

<section id="appointments">
  <h2>Find GI Doctors Near You</h2>
  <p class="section-text">
    You can find gastroenterologists near your location. Click on a marker to view details and directions.
  </p>
  
  <div id="map" style="width:100%;max-width:900px;height:400px;margin:auto;border-radius:16px;overflow:hidden;border:1px solid var(--border);"></div>
  
  <div class="section-nav" style="justify-content:center;margin-top:20px;">
    <a href="https://www.example-mri-booking.com" target="_blank" rel="noopener" class="btn btn-next">
      üè• Book Your Appointment
    </a>
  </div>
</section>


<footer>
 GastroVisionAI Research-Driven Artificial Medical Intelligence
</footer>

<script>
/* =====================
   CONSTANTS & CONFIG
===================== */
const FLASK_API_URL = 'http://127.0.0.1:5000/predict';
const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
const MIN_IMAGE_WIDTH = 200;
const MIN_IMAGE_HEIGHT = 200;
const NEURAL_DISTANCE = 140;
const PARTICLE_SPAWN_INTERVAL = 250;

/* =====================
   STATE VARIABLES
===================== */
let isAnalyzing = false;
let scanHistory = JSON.parse(localStorage.getItem('scanHistory')) || [];

/* =====================
   DOM ELEMENTS
===================== */
const img = document.getElementById('img');
const mammo = document.getElementById('mammo');
const form = document.getElementById('form');
const result = document.getElementById('result');
const progressBar = document.getElementById('progressBar');
const historyContainer = document.getElementById('history');
const submitBtn = document.getElementById('submitBtn');
const exportSection = document.getElementById('exportSection');
const exportPdfBtn = document.getElementById('exportPdfBtn');
const exportCsvBtn = document.getElementById('exportCsvBtn');
const connectionStatus = document.getElementById('connectionStatus');
const loadingOverlay = document.getElementById('loadingOverlay');
const loadingText = document.getElementById('loadingText');

/* =====================
   INITIALIZATION
===================== */
document.addEventListener('DOMContentLoaded', function() {
  // Test backend connection on load
  testBackendConnection();
  
  // Initialize history display
  updateHistoryDisplay();
  updateExportSection();
  
  // Add event listeners for export buttons
  if (exportPdfBtn) {
    exportPdfBtn.addEventListener('click', exportToPDF);
  }
  
  if (exportCsvBtn) {
    exportCsvBtn.addEventListener('click', exportToCSV);
  }
  
  // Add particles
  startParticles();
  
  // Start neural network animation
  startNeuralNetwork();
});

/* =====================
   BACKEND CONNECTION TEST
===================== */
async function testBackendConnection() {
  try {
    showLoading('Testing backend connection...');
    
    const response = await fetch('http://127.0.0.1:5000/', {
      method: 'GET',
      headers: { 'Accept': 'application/json' }
    });
    
    hideLoading();
    
    if (response.ok) {
      const data = await response.json();
      console.log('‚úÖ Backend connected:', data);
      showConnectionStatus('‚úÖ Connected to AI Server', 'connected');
    } else {
      showConnectionStatus('‚ö†Ô∏è Backend Error', 'disconnected');
      console.error('Backend error:', response.status);
    }
  } catch (error) {
    hideLoading();
    showConnectionStatus('‚ùå Backend Not Running', 'disconnected');
    console.error('Backend connection failed:', error);
  }
}

function showConnectionStatus(message, type) {
  if (!connectionStatus) return;
  
  connectionStatus.textContent = message;
  connectionStatus.className = type;
  
  // Auto-hide success message after 5 seconds
  if (type === 'connected') {
    setTimeout(() => {
      connectionStatus.style.display = 'none';
    }, 5000);
  }
}

function showLoading(message) {
  if (!loadingOverlay || !loadingText) return;
  
  loadingText.textContent = message;
  loadingOverlay.style.display = 'flex';
}

function hideLoading() {
  if (!loadingOverlay) return;
  loadingOverlay.style.display = 'none';
}

/* =====================
   IMAGE PREVIEW HANDLING
===================== */
img.addEventListener('change', function() {
  const file = this.files[0];
  if (!file) return;
  
  // Validate file type
  if (!file.type.startsWith('image/')) {
    showError('‚ùå Error: Please select a valid image file');
    this.value = '';
    return;
  }
  
  // Validate file size
  if (file.size > MAX_FILE_SIZE) {
    showError('‚ùå Error: Image size must be less than 5MB');
    this.value = '';
    return;
  }

  const reader = new FileReader();
  
  reader.onerror = () => {
    showError('‚ùå Error: Failed to read file. Please try again.');
  };
  
  reader.onload = e => {
    const imgTest = new Image();
    imgTest.onload = () => {
      if (imgTest.width < MIN_IMAGE_WIDTH || imgTest.height < MIN_IMAGE_HEIGHT) {
        showError(`‚ùå Error: Image must be at least ${MIN_IMAGE_WIDTH}x${MIN_IMAGE_HEIGHT} pixels`);
        return;
      }
      
      // Display image preview
      if (mammo) {
        mammo.style.backgroundImage = `url(${e.target.result})`;
        mammo.textContent = '';
        mammo.classList.remove('positive', 'negative', 'warning', 'info', 'medical', 'analyzing');
      }
      
      if (result) {
        result.textContent = '';
        result.classList.remove('show', 'positive', 'negative', 'warning', 'info', 'medical');
      }
    };
    imgTest.src = e.target.result;
  };
  reader.readAsDataURL(file);
});

/* =====================
   FORM SUBMISSION - REAL API CALL
===================== */
form.addEventListener('submit', async function(e) {
  e.preventDefault();
  
  if (!img.files[0]) {
    showError('‚ùå Please upload an image first');
    return;
  }
  
  // Prevent multiple simultaneous scans
  if (isAnalyzing) {
    showError('‚è≥ Please wait for current analysis to complete');
    return;
  }
  
  isAnalyzing = true;
  
  // Disable button during scan
  if (submitBtn) submitBtn.disabled = true;

  // Reset UI state
  if (mammo) {
    mammo.classList.remove('positive', 'negative', 'warning', 'info', 'medical');
    mammo.classList.add('analyzing');
  }
  
  if (result) {
    result.classList.remove('positive', 'negative', 'warning', 'info', 'medical', 'show');
    result.classList.add('show');
    result.textContent = 'üß† AI analyzing pancreatic tissue patterns...';
  }
  
  // Start progress bar
  if (progressBar) {
    progressBar.classList.add('active');
  }

  try {
    // Create FormData (MUST use 'image' as key to match Flask)
    const formData = new FormData();
    formData.append('image', img.files[0]);
    
    // Send to Flask backend
    const response = await fetch(FLASK_API_URL, {
      method: 'POST',
      body: formData
    });
    
    const data = await response.json();
    
    // Stop animations
    if (mammo) mammo.classList.remove('analyzing');
    if (submitBtn) submitBtn.disabled = false;
    isAnalyzing = false;
    if (progressBar) {
      progressBar.classList.remove('active');
      progressBar.style.width = '0%';
    }
    
    if (response.ok && data.success !== false) {
      // SUCCESS: Handle response
      handleAPIResponse(data);
    } else {
      // ERROR from Flask
      const errorMsg = data.error || data.message || 'Unknown error';
      showError(`‚ùå AI Analysis Failed<br>${errorMsg}`);
    }
    
  } catch (error) {
    // NETWORK ERROR
    if (mammo) mammo.classList.remove('analyzing');
    if (submitBtn) submitBtn.disabled = false;
    isAnalyzing = false;
    if (progressBar) {
      progressBar.classList.remove('active');
      progressBar.style.width = '0%';
    }
    
    showError(`‚ùå Network Error<br>Failed to connect to AI server<br><small>Check if Flask server is running on port 5000</small>`);
    console.error('API Error:', error);
  }
});

/* =====================
   HANDLE API RESPONSE
===================== */
function handleAPIResponse(data) {
  const timestamp = new Date().toLocaleString();
  
  // Clear previous results
  if (mammo) {
    mammo.classList.remove('positive', 'negative', 'warning', 'info', 'medical');
  }
  
  if (result) {
    result.classList.remove('positive', 'negative', 'warning', 'info', 'medical', 'show');
  }
  
  if (data.success === false) {
    // Error case
    showError(`‚ùå ${data.error || 'Analysis failed'}<br>${data.message || ''}`);
    return;
  }
  
  // Check if we have predictions
  const hasPredictions = data.predictions && Array.isArray(data.predictions) && data.predictions.length > 0;
  
  if (!hasPredictions) {
    showError('‚ùå No analysis results returned from AI model');
    return;
  }
  
  const predictions = data.predictions;
  const clinical = data.clinical_assessment || { overall_risk: 'UNKNOWN' };
  const overallRisk = clinical.overall_risk || 'UNKNOWN';
  
  // Determine result type based on overall risk
  const riskClass = getRiskClass(overallRisk);
  
  if (mammo) mammo.classList.add(riskClass);
  if (result) {
    result.classList.add(riskClass, 'show');
    
    // Build result display
    let resultHTML = '';
    
    // Header with overall risk
    resultHTML += `<div style="margin-bottom: 15px;">`;
    resultHTML += `<h3 style="margin: 0 0 10px 0; color: ${getRiskColor(overallRisk)};">`;
    resultHTML += `${getRiskIcon(overallRisk)} <strong>${overallRisk} RISK</strong>`;
    resultHTML += `</h3>`;
    
    if (data.processing_time) {
      resultHTML += `<div style="font-size: 0.9em; opacity: 0.8;">Processed in ${data.processing_time}</div>`;
    }
    
    resultHTML += `</div>`;
    
    // Each finding
    predictions.forEach((pred, index) => {
      const displayName = pred.display_name || pred.class || 'Unknown Finding';
      const confidence = pred.confidence ? (pred.confidence * 100).toFixed(1) : 'N/A';
      const riskLevel = pred.risk_level || 'UNKNOWN';
      const recommendation = pred.recommendation || 'Further evaluation recommended.';
      const nextSteps = pred.next_steps || ['Consult specialist'];
      
      resultHTML += `
        <div style="
          background: ${getRiskBackground(riskLevel)};
          border-left: 4px solid ${getRiskColor(riskLevel)};
          padding: 12px;
          margin: 10px 0;
          border-radius: 0 8px 8px 0;
        ">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 1.2em; margin-right: 10px;">${pred.icon || 'üîç'}</span>
            <strong>${displayName}</strong>
          </div>
          
          <div style="font-size: 0.9em; margin-bottom: 8px;">
            <span class="risk-badge risk-${riskLevel.toLowerCase()}" style="margin-right: 8px;">
              ${riskLevel} Risk
            </span>
          </div>
          
          <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px;">
            ${recommendation}
          </div>
          
          <div style="font-size: 0.85em; color: var(--accent);">
            <strong>Next Steps:</strong> ${Array.isArray(nextSteps) ? nextSteps.join(', ') : nextSteps}
          </div>
        </div>
      `;
    });
    
    // Clinical summary
    if (clinical.summary || predictions.length > 0) {
      const cancerStage = clinical.stage || 'Unknown Stage';
      const findingName = predictions[0] ? (predictions[0].display_name || predictions[0].class) : 'Unknown';
      let cancerDetectionStatement = overallRisk === 'HIGH' || overallRisk === 'MODERATE' 
        ? `Detected the possibility of ${findingName} (${cancerStage})`
        : clinical.summary || `No abnormal findings detected`;
      
      // Remove confidence percentage if present
      cancerDetectionStatement = cancerDetectionStatement.replace(/\s*with\s+[\d.]+%\s*confidence\.?/i, '');
      
      resultHTML += `
        <div style="
          background: rgba(56, 189, 248, 0.1);
          padding: 12px;
          margin: 15px 0;
          border-radius: 8px;
          border: 1px solid var(--border);
        ">
          <strong>üìã Clinical Summary:</strong><br>
          ${cancerDetectionStatement}
        </div>
      `;
    }
    
    // Follow-up plan
    if (clinical.follow_up) {
      resultHTML += `
        <div style="
          background: rgba(16, 185, 129, 0.1);
          padding: 12px;
          margin-top: 15px;
          border-radius: 8px;
          border: 1px solid rgba(16, 185, 129, 0.3);
        ">
          <strong>üìÖ Follow-up Plan:</strong><br>
          ${clinical.follow_up}
        </div>
      `;
    }
    
    result.innerHTML = resultHTML;
  }
  
  // Save to history
  const isNormal = predictions[0] && predictions[0].class === 'Normal_Pancreas';
  const historyItem = {
    type: isNormal ? 'normal' : 'abnormal',
    findings: predictions.map(p => p.display_name || p.class || 'Unknown'),
    risk: overallRisk,
    confidence: predictions.map(p => p.confidence ? (p.confidence * 100).toFixed(1) + '%' : 'N/A').join(' / '),
    timestamp: timestamp,
    rawData: data
  };
  
  addToHistory(historyItem);
  
  // Update UI
  updateHistoryDisplay();
  updateExportSection();
  updateAnalytics();
}

/* =====================
   RISK UTILITY FUNCTIONS
===================== */
function getRiskClass(riskLevel) {
  if (!riskLevel) return 'info';
  
  const level = riskLevel.toUpperCase();
  switch(level) {
    case 'HIGH': return 'positive';
    case 'MODERATE': return 'warning';
    case 'LOW': return 'info';
    case 'MEDICAL': return 'medical';
    case 'NONE': return 'negative';
    default: return 'info';
  }
}

function getRiskColor(riskLevel) {
  if (!riskLevel) return '#3b82f6';
  
  const level = riskLevel.toUpperCase();
  switch(level) {
    case 'HIGH': return '#ef4444';    // Red
    case 'MODERATE': return '#f59e0b'; // Amber
    case 'LOW': return '#3b82f6';     // Blue
    case 'MEDICAL': return '#8b5cf6'; // Purple
    case 'NONE': return '#10b981';    // Green
    default: return '#3b82f6';        // Blue (default)
  }
}

function getRiskBackground(riskLevel) {
  if (!riskLevel) return 'rgba(59, 130, 246, 0.1)';
  
  const level = riskLevel.toUpperCase();
  switch(level) {
    case 'HIGH': return 'rgba(239, 68, 68, 0.1)';
    case 'MODERATE': return 'rgba(245, 158, 11, 0.1)';
    case 'LOW': return 'rgba(59, 130, 246, 0.1)';
    case 'MEDICAL': return 'rgba(139, 92, 246, 0.1)';
    case 'NONE': return 'rgba(16, 185, 129, 0.1)';
    default: return 'rgba(59, 130, 246, 0.1)';
  }
}

function getRiskIcon(riskLevel) {
  if (!riskLevel) return 'üîµ';
  
  const level = riskLevel.toUpperCase();
  switch(level) {
    case 'HIGH': return '‚ö†Ô∏è';
    case 'MODERATE': return 'üü°';
    case 'LOW': return 'üîµ';
    case 'MEDICAL': return 'üè•';
    case 'NONE': return '‚úÖ';
    default: return 'üîµ';
  }
}

/* =====================
   HISTORY MANAGEMENT
===================== */
function addToHistory(scan) {
  scanHistory.unshift(scan);
  // Keep only last 10 scans
  if (scanHistory.length > 10) {
    scanHistory.pop();
  }
  localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
}

function updateHistoryDisplay() {
  if (!historyContainer) return;
  
  if (scanHistory.length === 0) {
    historyContainer.innerHTML = '';
    return;
  }
  
  historyContainer.innerHTML = `
    <h3>
      <span>üìã Scan History (${scanHistory.length})</span>
      <div class="history-header-controls">
        <button class="clear-history-btn">Clear All</button>
        <span class="history-toggle">‚ñº</span>
      </div>
    </h3>
    <div id="historyList"></div>
  `;
  
  const historyList = document.getElementById('historyList');
  const historyTitle = historyContainer.querySelector('h3');
  const clearBtn = historyContainer.querySelector('.clear-history-btn');
  const toggleBtn = historyContainer.querySelector('.history-toggle');
  
  if (!historyList || !historyTitle || !clearBtn || !toggleBtn) return;
  
  // Toggle history visibility
  historyTitle.addEventListener('click', (e) => {
    if (!e.target.closest('.clear-history-btn')) {
      historyList.classList.toggle('expanded');
      toggleBtn.textContent = historyList.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
    }
  });
  
  // Clear all history
  clearBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (confirm('Clear all scan history? This action cannot be undone.')) {
      scanHistory = [];
      localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
      updateHistoryDisplay();
      updateExportSection();
      updateAnalytics();
    }
  });
  
  // Add each history item
  scanHistory.forEach((scan, index) => {
    const item = document.createElement('div');
    item.className = `history-item ${scan.type}`;
    item.title = `Time: ${scan.timestamp}\nRisk: ${scan.risk}\nClick to copy details`;
    
    const text = document.createElement('span');
    text.className = 'history-item-text';
    
    // Get first finding or default
    const firstFinding = scan.findings && scan.findings.length > 0 
      ? scan.findings[0] 
      : (scan.type === 'normal' ? 'Normal' : 'Abnormal');
    
    // Truncate if too long
    const displayText = firstFinding.length > 30 
      ? firstFinding.substring(0, 27) + '...' 
      : firstFinding;
    
    if (scan.type === 'abnormal') {
      text.textContent = `üî¥ ${displayText} (${scan.confidence})`;
    } else {
      text.textContent = `üü¢ ${displayText} (${scan.confidence})`;
    }
    
    text.addEventListener('click', () => copyToClipboard(scan));
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'history-item-delete';
    deleteBtn.textContent = '√ó';
    deleteBtn.title = 'Delete this scan';
    deleteBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      scanHistory.splice(index, 1);
      localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
      updateHistoryDisplay();
      updateExportSection();
      updateAnalytics();
    });
    
    item.appendChild(text);
    item.appendChild(deleteBtn);
    historyList.appendChild(item);
  });
  
  // Show history by default if there are items
  if (scanHistory.length > 0) {
    historyList.classList.add('expanded');
    toggleBtn.textContent = '‚ñ≤';
  }
}

function copyToClipboard(scan) {
  const findingsText = scan.findings ? scan.findings.join(', ') : 'Unknown findings';
  const text = `GastroVisionAI Result:\nFindings: ${findingsText}\nRisk: ${scan.risk}\nConfidence: ${scan.confidence}\nTime: ${scan.timestamp}`;
  
  navigator.clipboard.writeText(text).then(() => {
    showSuccess('‚úÖ Result copied to clipboard!');
  }).catch(err => {
    console.error('Failed to copy:', err);
    showError('‚ùå Failed to copy to clipboard');
  });
}

/* =====================
   ERROR HANDLING
===================== */
function showError(message) {
  if (!result) return;
  
  result.classList.add('positive');
  result.classList.remove('negative', 'warning', 'info', 'medical');
  result.classList.add('show');
  result.innerHTML = message;
  
  // Auto-clear after 10 seconds
  setTimeout(() => {
    if (result.classList.contains('show')) {
      result.classList.remove('show');
    }
  }, 10000);
}

function showSuccess(message) {
  if (!result) return;
  
  result.classList.add('negative');
  result.classList.remove('positive', 'warning', 'info', 'medical');
  result.classList.add('show');
  result.innerHTML = message;
  
  // Auto-clear after 3 seconds
  setTimeout(() => {
    if (result.innerHTML === message) {
      result.classList.remove('show');
    }
  }, 3000);
}

/* =====================
   EXPORT FUNCTIONALITY
===================== */
function updateExportSection() {
  if (!exportSection) return;
  
  exportSection.style.display = scanHistory.length > 0 ? 'flex' : 'none';
}

function exportToPDF() {
  if (scanHistory.length === 0) {
    showError('‚ùå No scans to export');
    return;
  }
  
  let content = `
    GASTROVISION AI - MEDICAL SCAN REPORT
    ============================================
    
    Report Generated: ${new Date().toLocaleString()}
    Total Scans Analyzed: ${scanHistory.length}
    
    SUMMARY
    ============================================
    Abnormal Findings: ${scanHistory.filter(s => s.type === 'abnormal').length}
    Normal Results: ${scanHistory.filter(s => s.type === 'normal').length}
    
    DETAILED SCAN RESULTS
    ============================================
  `;
  
  scanHistory.forEach((scan, idx) => {
    content += `\nScan #${idx + 1}\n`;
    content += `Time: ${scan.timestamp}\n`;
    content += `Risk Level: ${scan.risk}\n`;
    content += `Confidence: ${scan.confidence}\n`;
    
    if (scan.findings && scan.findings.length > 0) {
      content += `Findings: ${scan.findings.join(', ')}\n`;
    }
    
    content += `-------------------------------------------\n`;
  });
  
  content += `
    ============================================
    END OF REPORT
    
    Note: This is an AI-assisted analysis. 
    All results should be reviewed by a qualified medical professional.
    
    GastroVisionAI - Pancreatic Cancer Detection System
    ¬© ${new Date().getFullYear()} All rights reserved.
  `;
  
  // Create and download text file
  const element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
  element.setAttribute('download', `gastrovision_report_${new Date().getTime()}.txt`);
  element.style.display = 'none';
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
  
  showSuccess('‚úÖ Report exported successfully!');
}

function exportToCSV() {
  if (scanHistory.length === 0) {
    showError('‚ùå No scans to export');
    return;
  }
  
  let csv = 'Timestamp,Result Type,Risk Level,Confidence,Findings\n';
  
  scanHistory.forEach(scan => {
    const findings = scan.findings ? scan.findings.join('; ') : '';
    csv += `"${scan.timestamp}","${scan.type}","${scan.risk}","${scan.confidence}","${findings}"\n`;
  });
  
  const element = document.createElement('a');
  element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
  element.setAttribute('download', `gastrovision_scans_${new Date().getTime()}.csv`);
  element.style.display = 'none';
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
  
  showSuccess('‚úÖ CSV exported successfully!');
}

/* =====================
   ANALYTICS DASHBOARD
===================== */
function updateAnalytics() {
  if (scanHistory.length === 0) return;
  
  const totalScans = scanHistory.length;
  const abnormalScans = scanHistory.filter(s => s.type === 'abnormal').length;
  const normalScans = scanHistory.filter(s => s.type === 'normal').length;
  
  const abnormalRate = totalScans > 0 ? ((abnormalScans / totalScans) * 100).toFixed(1) : 0;
  
  console.log('üìä Analytics Updated:', {
    totalScans,
    abnormalScans,
    normalScans,
    abnormalRate: `${abnormalRate}%`
  });
}

/* =====================
   VISUAL EFFECTS
===================== */
function startParticles() {
  const box = document.getElementById('particles');
  if (!box) return;
  
  setInterval(() => {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + 'vw';
    p.style.bottom = '-10px';
    p.style.animationDuration = (Math.random() * 10 + 8) + 's';
    box.appendChild(p);
    
    // Remove particle after animation completes
    setTimeout(() => {
      if (p.parentNode === box) {
        box.removeChild(p);
      }
    }, 15000);
  }, PARTICLE_SPAWN_INTERVAL);
}

function startNeuralNetwork() {
  const canvas = document.getElementById('neural');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  
  resize();
  window.addEventListener('resize', resize);
  
  // Create nodes
  const nodes = Array.from({ length: 40 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.5,
    vy: (Math.random() - 0.5) * 0.5
  }));
  
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Update and draw nodes
    nodes.forEach(node => {
      // Move node
      node.x += node.vx;
      node.y += node.vy;
      
      // Bounce off edges
      if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
      if (node.y < 0 || node.y > canvas.height) node.vy *= -1;
      
      // Draw connections
      nodes.forEach(otherNode => {
        const dx = node.x - otherNode.x;
        const dy = node.y - otherNode.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance < NEURAL_DISTANCE) {
          const opacity = 1 - (distance / NEURAL_DISTANCE);
          ctx.strokeStyle = `rgba(56, 189, 248, ${opacity * 0.3})`;
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(node.x, node.y);
          ctx.lineTo(otherNode.x, otherNode.y);
          ctx.stroke();
        }
      });
    });
    
    requestAnimationFrame(animate);
  }
  
  animate();
}
</script>

<section id="appointments">
  <h2>Find GI Doctors Near You</h2>
  <p class="section-text">
    Allow location access to find gastroenterologists near you.
  </p>
  
  <div id="map" style="width:100%;max-width:900px;height:400px;margin:auto;border-radius:16px;overflow:hidden;border:1px solid var(--border);"></div>
  
  <div class="section-nav" style="justify-content:center;margin-top:20px;">
    <a href="https://www.example-mri-booking.com" target="_blank" rel="noopener" class="btn btn-next">
      üè• Book Your Appointment
    </a>
  </div>
</section>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
<script>
function initMap() {
  const defaultLocation = { lat: 14.5995, lng: 120.9842 }; // Manila fallback
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 14,
    center: defaultLocation,
  });

  const infoWindow = new google.maps.InfoWindow();

  // Try HTML5 geolocation
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const userPos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude,
        };
        map.setCenter(userPos);

        // User marker
        new google.maps.Marker({
          position: userPos,
          map,
          title: "You are here",
          icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        });

        // Search for GI doctors nearby
        const service = new google.maps.places.PlacesService(map);
        service.nearbySearch(
          {
            location: userPos,
            radius: 5000, // 5 km radius
            keyword: "gastroenterologist"
          },
          (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
              results.forEach(place => {
                const marker = new google.maps.Marker({
                  position: place.geometry.location,
                  map,
                  title: place.name,
                });

                marker.addListener("click", () => {
                  infoWindow.setContent(`<strong>${place.name}</strong><br>${place.vicinity}`);
                  infoWindow.open(map, marker);
                });
              });
            } else {
              console.error("Places API error:", status);
            }
          }
        );
      },
      () => {
        infoWindow.setPosition(defaultLocation);
        infoWindow.setContent("Geolocation failed. Showing default location.");
        infoWindow.open(map);
      }
    );
  } else {
    // Browser doesn't support Geolocation
    infoWindow.setPosition(defaultLocation);
    infoWindow.setContent("Geolocation not supported by this browser.");
    infoWindow.open(map);
  }
}

// Initialize map on load
window.addEventListener("load", initMap);
</script>

</body>
</html>